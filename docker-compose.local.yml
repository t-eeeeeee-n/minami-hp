services:
  app:
    container_name: "minami-hp-container"
    image: "minami-hp-image"
    build:
      context: .
      dockerfile: ./docker/Dockerfile.local
    working_dir: /app
    volumes:
      - ".:/app"
      - node_modules:/app/node_modules
    ports:
      - "5173:5173"
    tty: true
    env_file:
      - .env.local
    environment:
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
      - CHOKIDAR_INTERVAL=1000
      - NEXT_TELEMETRY_DISABLED=1
    command: ["npx", "next", "dev", "-p", "5173", "--webpack"]
    depends_on:
      - minio

  minio:
    container_name: "minami-hp-minio"
    build:
      context: .
      dockerfile: ./docker/Dockerfile.minio
    ports:
      - "9000:9000"   # S3 API
      - "9001:9001"   # 管理コンソール
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    volumes:
      - minio-data:/data

volumes:
  node_modules:
  minio-data:
